{"version":3,"names":["React","useCallback","useRef","useImperativeHandle","forwardRef","findNodeHandle","requireNativeComponent","UIManager","DEFAULT_DRAWING_TOOL","asPath","RNDrawablePdfView","strokesToJson","strokes","length","JSON","stringify","NativeDrawablePdfView","props","ref","source","page","resizeMode","annotationStr","annotation","drawingMode","drawingTool","minZoom","maxZoom","zoomEnabled","onError","onLayout","onLoadComplete","onDrawingStart","onDrawingEnd","onStrokeEnd","onStrokeRemoved","onStrokesCleared","onZoomChange","onZoomPanStart","onZoomPanEnd","onSingleTap","style","viewRef","clearStrokes","current","handle","dispatchViewManagerCommand","resetZoom","handlePdfError","event","nativeEvent","handlePdfLoadComplete","handleDrawingStart","_event","handleDrawingEnd","handleStrokeEnd","id","color","width","opacity","path","handleStrokeRemoved","handleStrokesCleared","handleZoomChange","handleZoomPanStart","handleZoomPanEnd","handleSingleTap","createElement","strokeColor","strokeWidth","strokeOpacity","onPdfError","onPdfLoadComplete"],"sources":["NativeDrawablePdfView.tsx"],"sourcesContent":["import React, { useCallback, useRef, useImperativeHandle, forwardRef } from 'react';\nimport {\n  findNodeHandle,\n  LayoutChangeEvent,\n  NativeSyntheticEvent,\n  requireNativeComponent,\n  UIManager,\n  ViewStyle,\n} from 'react-native';\nimport type { DrawingMode, DrawingStroke, DrawingTool } from './drawing/types';\nimport { DEFAULT_DRAWING_TOOL } from './drawing/types';\nimport { asPath } from './Util';\n\n// --- Event types ---\n\nexport type ErrorEvent = { message: string };\n\nexport type LoadCompleteEvent = { height: number; width: number };\n\nexport type StrokeEndEvent = {\n  id: string;\n  color: string;\n  width: number;\n  opacity: number;\n  path: [number, number][];\n};\n\nexport type StrokeRemovedEvent = {\n  id: string;\n};\n\nexport type ZoomChangeEvent = {\n  scale: number;\n  offsetX: number;\n  offsetY: number;\n};\n\n// --- Native Props ---\n\ntype NativeDrawablePdfViewProps = {\n  // PDF props\n  source: string;\n  page: number;\n  resizeMode?: 'contain' | 'fitWidth';\n  annotation?: string;\n  annotationStr?: string;\n\n  // Drawing props\n  drawingMode: string;\n  strokeColor: string;\n  strokeWidth: number;\n  strokeOpacity: number;\n  strokes: string;\n\n  // Zoom props\n  minZoom: number;\n  maxZoom: number;\n  zoomEnabled: boolean;\n\n  // Events\n  onLayout?: (event: LayoutChangeEvent) => void;\n  onPdfError: (event: NativeSyntheticEvent<ErrorEvent>) => void;\n  onPdfLoadComplete: (event: NativeSyntheticEvent<LoadCompleteEvent>) => void;\n  onDrawingStart: (event: NativeSyntheticEvent<{}>) => void;\n  onDrawingEnd: (event: NativeSyntheticEvent<{}>) => void;\n  onStrokeEnd: (event: NativeSyntheticEvent<StrokeEndEvent>) => void;\n  onStrokeRemoved: (event: NativeSyntheticEvent<StrokeRemovedEvent>) => void;\n  onStrokesCleared: (event: NativeSyntheticEvent<{}>) => void;\n  onZoomChange: (event: NativeSyntheticEvent<ZoomChangeEvent>) => void;\n  onZoomPanStart: (event: NativeSyntheticEvent<{}>) => void;\n  onZoomPanEnd: (event: NativeSyntheticEvent<{}>) => void;\n  onSingleTap: (event: NativeSyntheticEvent<{}>) => void;\n\n  style?: ViewStyle;\n};\n\n// --- Public Props ---\n\nexport type NativeDrawablePdfViewProps_Public = {\n  /**\n   * Document to display.\n   */\n  source: string;\n\n  /**\n   * Page (0-indexed) of document to display.\n   */\n  page: number;\n\n  /**\n   * How pdf page should be scaled to fit in view dimensions.\n   */\n  resizeMode?: 'contain' | 'fitWidth';\n\n  /**\n   * PAS v1 annotation JSON string.\n   */\n  annotationStr?: string;\n\n  /**\n   * Path to annotation data file.\n   */\n  annotation?: string;\n\n  /**\n   * Drawing mode.\n   * - 'view': No drawing, just viewing (zoom enabled)\n   * - 'draw': Drawing mode with current tool (zoom disabled)\n   * - 'erase': Erase strokes by touching them (zoom disabled)\n   * - 'highlight': Drawing with highlighter (zoom disabled)\n   */\n  drawingMode?: DrawingMode;\n\n  /**\n   * Drawing tool configuration.\n   */\n  drawingTool?: DrawingTool;\n\n  /**\n   * Current strokes on this page.\n   */\n  strokes?: DrawingStroke[];\n\n  /**\n   * Minimum zoom level. Default: 1.\n   */\n  minZoom?: number;\n\n  /**\n   * Maximum zoom level. Default: 3.\n   */\n  maxZoom?: number;\n\n  /**\n   * Enable/disable zoom gestures. Default: true.\n   * Note: Zoom is automatically disabled in draw/erase/highlight modes.\n   */\n  zoomEnabled?: boolean;\n\n  /**\n   * Callback when an error occurs.\n   */\n  onError?: (event: ErrorEvent) => void;\n\n  /**\n   * Callback for measuring the native view.\n   */\n  onLayout?: (event: LayoutChangeEvent) => void;\n\n  /**\n   * Callback when PDF load completes.\n   */\n  onLoadComplete?: (event: LoadCompleteEvent) => void;\n\n  /**\n   * Callback when drawing starts.\n   */\n  onDrawingStart?: () => void;\n\n  /**\n   * Callback when drawing ends.\n   */\n  onDrawingEnd?: () => void;\n\n  /**\n   * Callback when a stroke is completed.\n   */\n  onStrokeEnd?: (stroke: DrawingStroke) => void;\n\n  /**\n   * Callback when a stroke is removed (erased).\n   */\n  onStrokeRemoved?: (strokeId: string) => void;\n\n  /**\n   * Callback when all strokes are cleared.\n   */\n  onStrokesCleared?: () => void;\n\n  /**\n   * Callback when zoom level changes.\n   */\n  onZoomChange?: (event: ZoomChangeEvent) => void;\n\n  /**\n   * Callback when zoom pan gesture starts (user starts dragging while zoomed).\n   */\n  onZoomPanStart?: () => void;\n\n  /**\n   * Callback when zoom pan gesture ends.\n   */\n  onZoomPanEnd?: () => void;\n\n  /**\n   * Callback when a single tap is detected in view mode (not zoomed).\n   * Used for tap-to-scroll functionality.\n   */\n  onSingleTap?: () => void;\n\n  style?: ViewStyle;\n};\n\n// --- Ref type ---\n\nexport type NativeDrawablePdfViewRef = {\n  /**\n   * Clear all strokes from the view.\n   */\n  clearStrokes: () => void;\n\n  /**\n   * Reset zoom to default (scale = 1).\n   */\n  resetZoom: () => void;\n};\n\n// --- Native component ---\n\nconst RNDrawablePdfView =\n  requireNativeComponent<NativeDrawablePdfViewProps>('RNDrawablePdfView');\n\n/**\n * Convert DrawingStroke[] to JSON string for native component.\n */\nfunction strokesToJson(strokes: DrawingStroke[]): string {\n  if (strokes.length === 0) return '';\n  return JSON.stringify(strokes);\n}\n\n/**\n * Native PDF view with drawing and zoom support.\n *\n * This component renders PDF with native drawing and pinch-to-zoom capabilities.\n * Touch events for drawing and zooming are handled natively for better performance.\n *\n * Features:\n * - Pinch-to-zoom with configurable min/max\n * - Double-tap to zoom in/reset\n * - Pan when zoomed in\n * - Drawing with pen and highlighter\n * - Eraser tool\n *\n * Supported platforms: Android, iOS\n */\nexport const NativeDrawablePdfView = forwardRef<\n  NativeDrawablePdfViewRef,\n  NativeDrawablePdfViewProps_Public\n>(function NativeDrawablePdfView(props, ref) {\n  const {\n    source,\n    page,\n    resizeMode,\n    annotationStr,\n    annotation,\n    drawingMode = 'view',\n    drawingTool = DEFAULT_DRAWING_TOOL,\n    strokes = [],\n    minZoom = 1,\n    maxZoom = 3,\n    zoomEnabled = true,\n    onError,\n    onLayout,\n    onLoadComplete,\n    onDrawingStart,\n    onDrawingEnd,\n    onStrokeEnd,\n    onStrokeRemoved,\n    onStrokesCleared,\n    onZoomChange,\n    onZoomPanStart,\n    onZoomPanEnd,\n    onSingleTap,\n    style,\n  } = props;\n\n  const viewRef = useRef<any>(null);\n\n  // Expose imperative methods\n  useImperativeHandle(ref, () => ({\n    clearStrokes: () => {\n      if (viewRef.current) {\n        const handle = findNodeHandle(viewRef.current);\n        if (handle) {\n          UIManager.dispatchViewManagerCommand(handle, 'clearStrokes', []);\n        }\n      }\n    },\n    resetZoom: () => {\n      if (viewRef.current) {\n        const handle = findNodeHandle(viewRef.current);\n        if (handle) {\n          UIManager.dispatchViewManagerCommand(handle, 'resetZoom', []);\n        }\n      }\n    },\n  }));\n\n  // Event handlers\n  const handlePdfError = useCallback(\n    (event: NativeSyntheticEvent<ErrorEvent>) => {\n      onError?.(event.nativeEvent);\n    },\n    [onError]\n  );\n\n  const handlePdfLoadComplete = useCallback(\n    (event: NativeSyntheticEvent<LoadCompleteEvent>) => {\n      onLoadComplete?.(event.nativeEvent);\n    },\n    [onLoadComplete]\n  );\n\n  const handleDrawingStart = useCallback(\n    (_event: NativeSyntheticEvent<{}>) => {\n      onDrawingStart?.();\n    },\n    [onDrawingStart]\n  );\n\n  const handleDrawingEnd = useCallback(\n    (_event: NativeSyntheticEvent<{}>) => {\n      onDrawingEnd?.();\n    },\n    [onDrawingEnd]\n  );\n\n  const handleStrokeEnd = useCallback(\n    (event: NativeSyntheticEvent<StrokeEndEvent>) => {\n      const { id, color, width, opacity, path } = event.nativeEvent;\n      onStrokeEnd?.({\n        id,\n        color,\n        width,\n        opacity,\n        path,\n      });\n    },\n    [onStrokeEnd]\n  );\n\n  const handleStrokeRemoved = useCallback(\n    (event: NativeSyntheticEvent<StrokeRemovedEvent>) => {\n      onStrokeRemoved?.(event.nativeEvent.id);\n    },\n    [onStrokeRemoved]\n  );\n\n  const handleStrokesCleared = useCallback(\n    (_event: NativeSyntheticEvent<{}>) => {\n      onStrokesCleared?.();\n    },\n    [onStrokesCleared]\n  );\n\n  const handleZoomChange = useCallback(\n    (event: NativeSyntheticEvent<ZoomChangeEvent>) => {\n      onZoomChange?.(event.nativeEvent);\n    },\n    [onZoomChange]\n  );\n\n  const handleZoomPanStart = useCallback(\n    (_event: NativeSyntheticEvent<{}>) => {\n      onZoomPanStart?.();\n    },\n    [onZoomPanStart]\n  );\n\n  const handleZoomPanEnd = useCallback(\n    (_event: NativeSyntheticEvent<{}>) => {\n      onZoomPanEnd?.();\n    },\n    [onZoomPanEnd]\n  );\n\n  const handleSingleTap = useCallback(\n    (_event: NativeSyntheticEvent<{}>) => {\n      onSingleTap?.();\n    },\n    [onSingleTap]\n  );\n\n  return (\n    <RNDrawablePdfView\n      ref={viewRef}\n      source={asPath(source)}\n      page={page}\n      resizeMode={resizeMode}\n      annotation={asPath(annotation)}\n      annotationStr={annotationStr}\n      drawingMode={drawingMode}\n      strokeColor={drawingTool.color}\n      strokeWidth={drawingTool.strokeWidth}\n      strokeOpacity={drawingTool.opacity}\n      strokes={strokesToJson(strokes)}\n      minZoom={minZoom}\n      maxZoom={maxZoom}\n      zoomEnabled={zoomEnabled}\n      onLayout={onLayout}\n      onPdfError={handlePdfError}\n      onPdfLoadComplete={handlePdfLoadComplete}\n      onDrawingStart={handleDrawingStart}\n      onDrawingEnd={handleDrawingEnd}\n      onStrokeEnd={handleStrokeEnd}\n      onStrokeRemoved={handleStrokeRemoved}\n      onStrokesCleared={handleStrokesCleared}\n      onZoomChange={handleZoomChange}\n      onZoomPanStart={handleZoomPanStart}\n      onZoomPanEnd={handleZoomPanEnd}\n      onSingleTap={handleSingleTap}\n      style={style}\n    />\n  );\n});"],"mappings":"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","ignoreList":[]}